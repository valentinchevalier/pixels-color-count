!function(e){var t={};function n(a){if(t[a])return t[a].exports;var i=t[a]={i:a,l:!1,exports:{}};return e[a].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=e,n.c=t,n.d=function(e,t,a){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:a})},n.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=4)}([function(e,t,n){"use strict";e.exports=function(){return new Worker(n.p+"d3ac1b6300cb5ec669b6.worker.js")}},function(e,t,n){"use strict";function a(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,i;return t=e,i=[{key:"rgbaToCSS",value:function(e){var t=e.a/255;return"rgba(".concat(e.r,", ").concat(e.g,", ").concat(e.b,", ").concat(t.toFixed(2),")")}},{key:"rgbaToHex",value:function(e){return"#".concat(this.integerToHex(e.r)).concat(this.integerToHex(e.g)).concat(this.integerToHex(e.b)).concat(this.integerToHex(e.a))}},{key:"integerToHex",value:function(e){var t=e.toString(16);return 1===t.length?"0".concat(t):t}},{key:"hexToRgba",value:function(e){var t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})?$/i.exec(e);return t?{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16),a:parseInt(t[4],16)}:null}},{key:"euclideanDistanceSquare",value:function(e,t){for(var n=0,a=0;a<e.length;a+=1){var i=e[a]-t[a];n+=i*i}return n}},{key:"hexSimilarity",value:function(e,t){return this.rgbSimilarity(this.hexToRgba(e),this.hexToRgba(t))}},{key:"rgbSimilarity",value:function(e,t){this.RGB_MAX_DISTANCE_SQUARE||(this.RGB_MAX_DISTANCE_SQUARE=this.euclideanDistanceSquare([255,255,255,255],[0,0,0,0]));var n=this.euclideanDistanceSquare([e.r,e.g,e.b,e.a],[t.r,t.g,t.b,t.a]);return 1-Math.sqrt(n/this.RGB_MAX_DISTANCE_SQUARE)}}],(n=null)&&a(t.prototype,n),i&&a(t,i),e}();t.default=i},function(e,t,n){"use strict";function a(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Performance";!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.performance=t}var t,n,i;return t=e,(n=[{key:"startExecution",value:function(){this.startTime=performance.now()}},{key:"stopExecution",value:function(){this.endTime=performance.now()}},{key:"getExecutionDuration",value:function(){return((this.endTime-this.startTime)/1e3).toFixed(3)}},{key:"log",value:function(){console.info("".concat(this.performance," : ").concat(this.getExecutionDuration()," secondes."))}}])&&a(t.prototype,n),i&&a(t,i),e}();t.default=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=o(n(2)),i=o(n(1)),r=o(n(0));function o(e){return e&&e.__esModule?e:{default:e}}function s(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var c=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,o;return t=e,o=[{key:"init",value:function(){var e=this;this.$body=document.querySelector("body"),this.$form=document.getElementById("analyseForm"),this.$inputImage=document.getElementById("uploadImage"),this.$inputThreshold=document.getElementById("threshold"),this.$imageDisplay=document.getElementById("display-image"),this.$imageAnalyse=document.getElementById("analyse-image"),this.$imageContainer=document.querySelector(".image-container"),this.$sizeBlock=document.getElementById("size-block"),this.$canvas=document.getElementById("canvas"),this.$progressBar=document.getElementById("progressBar"),this.$progressScan=document.querySelector(".progress-scan"),this.$results=document.querySelector(".resultats"),this.$form.addEventListener("submit",function(t){t.preventDefault(),e.threshold=e.$inputThreshold.value?Math.round(e.$inputThreshold.value):90,e.threshold<0||e.threshold>100||(e.threshold=e.threshold/100,e.startAnalysing())}),this.$inputImage.addEventListener("change",function(){e.loadImage()})}},{key:"startLoading",value:function(){this.$results.innerHTML="",this.$body.classList.add("is-loading"),this.setProgress(0)}},{key:"stopLoading",value:function(){this.$body.classList.remove("is-loading"),this.setProgress(0)}},{key:"setProgress",value:function(e){var t="".concat(e,"%");this.$progressBar.style.width=t,this.$progressBar.innerHTML=t,this.$progressScan.style.height=t}},{key:"startAnalysing",value:function(){var e=this;this.startLoading();var t=this.getImageData(),n=new r.default,i=new a.default("Temps de calcul");i.startExecution(),n.postMessage({imageData:t,similarityThreshold:this.threshold}),n.addEventListener("message",function(t){var r=t.data;if(r.type&&"progress"===r.type)e.setProgress(r.percentage);else{i.stopExecution(),i.log();var o=r.processedData,s=new a.default("Temps d'affichage des r√©sultats");s.startExecution(),e.displayResults(o),s.stopExecution(),s.log(),e.stopLoading(),n.terminate()}})}},{key:"getImageData",value:function(){var e=this.$canvas.getContext("2d"),t=this.$imageAnalyse,n=t.width,a=t.height;return this.$canvas.height=a,this.$canvas.width=n,e.drawImage(this.$imageAnalyse,0,0),e.getImageData(0,0,n,a).data}},{key:"displayResults",value:function(e){var t=document.createDocumentFragment();e.sort(function(e,t){return t.count-e.count}).splice(0,1e3).forEach(function(e){var n=i.default.rgbaToCSS(i.default.hexToRgba(e.color)),a=document.createElement("li");a.innerHTML='<div class="color-container"><span class="color" style="background-color: '.concat(n,';"></span><span class="color-text">').concat(n,"</span></div> ").concat(e.count),t.appendChild(a)}),this.$results.appendChild(t)}},{key:"loadImage",value:function(){var e=this,t=this.$inputImage.files;if(FileReader&&t&&t.length){var n=new FileReader;n.onload=function(){e.$imageDisplay.src=n.result,e.$imageAnalyse.src=n.result},n.readAsDataURL(t[0]),this.$imageAnalyse.onload=function(){e.displayImage(),e.displayImageSize()}}}},{key:"displayImage",value:function(){this.$imageContainer.classList.remove("hidden")}},{key:"displayImageSize",value:function(){this.$sizeBlock.innerHTML="Taille de l'image : ".concat(this.$imageAnalyse.height,"x").concat(this.$imageAnalyse.width," pixels.")}}],(n=null)&&s(t.prototype,n),o&&s(t,o),e}();t.default=c},function(e,t,n){"use strict";n(11);var a,i,r=(a=n(3))&&a.__esModule?a:{default:a};i=function(){r.default.init(),"serviceWorker"in navigator&&window.addEventListener("load",function(){navigator.serviceWorker.register("sw.js").then(function(e){console.log("SW registered: ",e)}).catch(function(e){console.log("SW registration failed: ",e)})})},(document.attachEvent?"complete"===document.readyState:"loading"!==document.readyState)?i():document.addEventListener("DOMContentLoaded",i)},,,,,,,function(e,t){}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vd2VicGFjay9ib290c3RyYXAiLCJ3ZWJwYWNrOi8vLy4vc3JjL2pzL2FuYWx5c2UtcGljdHVyZS53b3JrZXIuanMiLCJ3ZWJwYWNrOi8vLy4vc3JjL2pzL2NvbG9yLXV0aWxzLmpzIiwid2VicGFjazovLy8uL3NyYy9qcy9wZXJmLmpzIiwid2VicGFjazovLy8uL3NyYy9qcy9hbmFseXNlLXBpeGVscy5qcyIsIndlYnBhY2s6Ly8vLi9zcmMvaW5kZXguanMiXSwibmFtZXMiOlsiaW5zdGFsbGVkTW9kdWxlcyIsIl9fd2VicGFja19yZXF1aXJlX18iLCJtb2R1bGVJZCIsImV4cG9ydHMiLCJtb2R1bGUiLCJpIiwibCIsIm1vZHVsZXMiLCJjYWxsIiwibSIsImMiLCJkIiwibmFtZSIsImdldHRlciIsIm8iLCJPYmplY3QiLCJkZWZpbmVQcm9wZXJ0eSIsImNvbmZpZ3VyYWJsZSIsImVudW1lcmFibGUiLCJnZXQiLCJyIiwidmFsdWUiLCJuIiwiX19lc01vZHVsZSIsIm9iamVjdCIsInByb3BlcnR5IiwicHJvdG90eXBlIiwiaGFzT3duUHJvcGVydHkiLCJwIiwicyIsIldvcmtlciIsIkNvbG9yVXRpbHMiLCJyZ2JhQ29sb3IiLCJhbHBoYSIsImEiLCJjb25jYXQiLCJnIiwiYiIsInRvRml4ZWQiLCJ0aGlzIiwiaW50ZWdlclRvSGV4IiwiaGV4IiwidG9TdHJpbmciLCJsZW5ndGgiLCJyZXN1bHQiLCJleGVjIiwicGFyc2VJbnQiLCJsaXN0MSIsImxpc3QyIiwic3VtIiwib2Zmc2V0IiwiaGV4MSIsImhleDIiLCJyZ2JTaW1pbGFyaXR5IiwiaGV4VG9SZ2JhIiwicmdiMSIsInJnYjIiLCJSR0JfTUFYX0RJU1RBTkNFX1NRVUFSRSIsImV1Y2xpZGVhbkRpc3RhbmNlU3F1YXJlIiwiZGlzdGFuY2UiLCJNYXRoIiwic3FydCIsIlBlcmYiLCJwZXJmb3JtYW5jZSIsImFyZ3VtZW50cyIsInVuZGVmaW5lZCIsIl9jbGFzc0NhbGxDaGVjayIsInN0YXJ0VGltZSIsIm5vdyIsImVuZFRpbWUiLCJjb25zb2xlIiwiaW5mbyIsImdldEV4ZWN1dGlvbkR1cmF0aW9uIiwiX3BlcmYiLCJfaW50ZXJvcFJlcXVpcmVEZWZhdWx0IiwiX2NvbG9yVXRpbHMiLCJfYW5hbHlzZVBpY3R1cmUiLCJBbmFseXNlUGl4ZWxzIiwiX3RoaXMiLCIkYm9keSIsImRvY3VtZW50IiwicXVlcnlTZWxlY3RvciIsIiRmb3JtIiwiZ2V0RWxlbWVudEJ5SWQiLCIkaW5wdXRJbWFnZSIsIiRpbnB1dFRocmVzaG9sZCIsIiRpbWFnZURpc3BsYXkiLCIkaW1hZ2VBbmFseXNlIiwiJGltYWdlQ29udGFpbmVyIiwiJHNpemVCbG9jayIsIiRjYW52YXMiLCIkcHJvZ3Jlc3NCYXIiLCIkcHJvZ3Jlc3NTY2FuIiwiJHJlc3VsdHMiLCJhZGRFdmVudExpc3RlbmVyIiwic3VibWl0RXZlbnQiLCJwcmV2ZW50RGVmYXVsdCIsInRocmVzaG9sZCIsInJvdW5kIiwic3RhcnRBbmFseXNpbmciLCJsb2FkSW1hZ2UiLCJpbm5lckhUTUwiLCJjbGFzc0xpc3QiLCJhZGQiLCJzZXRQcm9ncmVzcyIsInJlbW92ZSIsInBlcmNlbnRhZ2UiLCJwZXJjZW50U3RyaW5nIiwic3R5bGUiLCJ3aWR0aCIsImhlaWdodCIsIl90aGlzMiIsInN0YXJ0TG9hZGluZyIsImltYWdlRGF0YSIsImdldEltYWdlRGF0YSIsIndvcmtlciIsImFuYWx5c2VQZXJmIiwic3RhcnRFeGVjdXRpb24iLCJwb3N0TWVzc2FnZSIsInNpbWlsYXJpdHlUaHJlc2hvbGQiLCJfcmVmIiwiZGF0YSIsInR5cGUiLCJzdG9wRXhlY3V0aW9uIiwibG9nIiwiYW5hbHlzZWRDb2xvcnMiLCJwcm9jZXNzZWREYXRhIiwiZGlzcGxheVBlcmYiLCJkaXNwbGF5UmVzdWx0cyIsInN0b3BMb2FkaW5nIiwidGVybWluYXRlIiwiY29udGV4dCIsImdldENvbnRleHQiLCJfJGltYWdlQW5hbHlzZSIsImRyYXdJbWFnZSIsImZyYWdtZW50IiwiY3JlYXRlRG9jdW1lbnRGcmFnbWVudCIsInNvcnQiLCJjb3VudCIsInNwbGljZSIsImZvckVhY2giLCJjb2xvckRhdGEiLCJjc3NDb2xvciIsInJnYmFUb0NTUyIsImNvbG9yIiwibGkiLCJjcmVhdGVFbGVtZW50IiwiYXBwZW5kQ2hpbGQiLCJfdGhpczMiLCJmaWxlcyIsIkZpbGVSZWFkZXIiLCJmaWxlUmVhZGVyIiwib25sb2FkIiwic3JjIiwicmVhZEFzRGF0YVVSTCIsImRpc3BsYXlJbWFnZSIsImRpc3BsYXlJbWFnZVNpemUiLCJjYWxsYmFjayIsIl9hbmFseXNlUGl4ZWxzIiwiaW5pdCIsIm5hdmlnYXRvciIsIndpbmRvdyIsInNlcnZpY2VXb3JrZXIiLCJyZWdpc3RlciIsInRoZW4iLCJyZWdpc3RyYXRpb24iLCJjYXRjaCIsInJlZ2lzdHJhdGlvbkVycm9yIiwiYXR0YWNoRXZlbnQiLCJyZWFkeVN0YXRlIl0sIm1hcHBpbmdzIjoiYUFDQSxJQUFBQSxLQUdBLFNBQUFDLEVBQUFDLEdBR0EsR0FBQUYsRUFBQUUsR0FDQSxPQUFBRixFQUFBRSxHQUFBQyxRQUdBLElBQUFDLEVBQUFKLEVBQUFFLElBQ0FHLEVBQUFILEVBQ0FJLEdBQUEsRUFDQUgsWUFVQSxPQU5BSSxFQUFBTCxHQUFBTSxLQUFBSixFQUFBRCxRQUFBQyxJQUFBRCxRQUFBRixHQUdBRyxFQUFBRSxHQUFBLEVBR0FGLEVBQUFELFFBS0FGLEVBQUFRLEVBQUFGLEVBR0FOLEVBQUFTLEVBQUFWLEVBR0FDLEVBQUFVLEVBQUEsU0FBQVIsRUFBQVMsRUFBQUMsR0FDQVosRUFBQWEsRUFBQVgsRUFBQVMsSUFDQUcsT0FBQUMsZUFBQWIsRUFBQVMsR0FDQUssY0FBQSxFQUNBQyxZQUFBLEVBQ0FDLElBQUFOLEtBTUFaLEVBQUFtQixFQUFBLFNBQUFqQixHQUNBWSxPQUFBQyxlQUFBYixFQUFBLGNBQWlEa0IsT0FBQSxLQUlqRHBCLEVBQUFxQixFQUFBLFNBQUFsQixHQUNBLElBQUFTLEVBQUFULEtBQUFtQixXQUNBLFdBQTJCLE9BQUFuQixFQUFBLFNB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MEcsRUFBVUgsT0FFN0tILEVBQVNZLFlBQVlGLEtBR3ZCMUcsS0FBS3NELFNBQVNzRCxZQUFZWix1Q0FHVCxJQUFBYSxFQUFBN0csS0FFZjhHLEVBQ0U5RyxLQUFLNkMsWUFEUGlFLE1BR0YsR0FBSUMsWUFBY0QsR0FBU0EsRUFBTTFHLE9BQVEsQ0FDdkMsSUFBTTRHLEVBQWEsSUFBSUQsV0FFdkJDLEVBQVdDLE9BQVMsV0FDbEJKLEVBQUs5RCxjQUFjbUUsSUFBTUYsRUFBVzNHLE9BQ3BDd0csRUFBSzdELGNBQWNrRSxJQUFNRixFQUFXM0csUUFFdEMyRyxFQUFXRyxjQUFjTCxFQUFNLElBRS9COUcsS0FBS2dELGNBQWNpRSxPQUFTLFdBQzFCSixFQUFLTyxlQUNMUCxFQUFLUSw0REFNVHJILEtBQUtpRCxnQkFBZ0JjLFVBQVVHLE9BQU8scURBSXRDbEUsS0FBS2tELFdBQVdZLFVBQWhCLHVCQUFBbEUsT0FBbURJLEtBQUtnRCxjQUFjdUIsT0FBdEUsS0FBQTNFLE9BQWdGSSxLQUFLZ0QsY0FBY3NCLE1BQW5HLG1HQ3hKSjVHLEVBQUEsSUFDQSxNQUVrQjRKLEVBRmxCQyxLQUFBN0osRUFBQSxnQ0FFa0I0SixFQVFULFdBQ1BoRixVQUFja0YsT0FFVixrQkFBbUJDLFdBQ3JCQyxPQUFPbkUsaUJBQWlCLE9BQVEsV0FDOUJrRSxVQUFVRSxjQUFjQyxTQUFTLFNBQVNDLEtBQUssU0FBQ0MsR0FDOUMvRixRQUFRc0QsSUFBSSxrQkFBbUJ5QyxLQUM5QkMsTUFBTSxTQUFDQyxHQUNSakcsUUFBUXNELElBQUksMkJBQTRCMkMsU0FmMUN2RixTQUFTd0YsWUFBc0MsYUFBeEJ4RixTQUFTeUYsV0FBb0QsWUFBeEJ6RixTQUFTeUYsWUFDdkVaLElBRUE3RSxTQUFTYyxpQkFBaUIsbUJBQW9CK0QiLCJmaWxlIjoiYXBwLmJ1bmRsZS5qcyIsInNvdXJjZXNDb250ZW50IjpbIiBcdC8vIFRoZSBtb2R1bGUgY2FjaGVcbiBcdHZhciBpbnN0YWxsZWRNb2R1bGVzID0ge307XG5cbiBcdC8vIFRoZSByZXF1aXJlIGZ1bmN0aW9uXG4gXHRmdW5jdGlvbiBfX3dlYnBhY2tfcmVxdWlyZV9fKG1vZHVsZUlkKSB7XG5cbiBcdFx0Ly8gQ2hlY2sgaWYgbW9kdWxlIGlzIGluIGNhY2hlXG4gXHRcdGlmKGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdKSB7XG4gXHRcdFx0cmV0dXJuIGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdLmV4cG9ydHM7XG4gXHRcdH1cbiBcdFx0Ly8gQ3JlYXRlIGEgbmV3IG1vZHVsZSAoYW5kIHB1dCBpdCBpbnRvIHRoZSBjYWNoZSlcbiBcdFx0dmFyIG1vZHVsZSA9IGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdID0ge1xuIFx0XHRcdGk6IG1vZHVsZUlkLFxuIFx0XHRcdGw6IGZhbHNlLFxuIFx0XHRcdGV4cG9ydHM6IHt9XG4gXHRcdH07XG5cbiBcdFx0Ly8gRXhlY3V0ZSB0aGUgbW9kdWxlIGZ1bmN0aW9uXG4gXHRcdG1vZHVsZXNbbW9kdWxlSWRdLmNhbGwobW9kdWxlLmV4cG9ydHMsIG1vZHVsZSwgbW9kdWxlLmV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pO1xuXG4gXHRcdC8vIEZsYWcgdGhlIG1vZHVsZSBhcyBsb2FkZWRcbiBcdFx0bW9kdWxlLmwgPSB0cnVlO1xuXG4gXHRcdC8vIFJldHVybiB0aGUgZXhwb3J0cyBvZiB0aGUgbW9kdWxlXG4gXHRcdHJldHVybiBtb2R1bGUuZXhwb3J0cztcbiBcdH1cblxuXG4gXHQvLyBleHBvc2UgdGhlIG1vZHVsZXMgb2JqZWN0IChfX3dlYnBhY2tfbW9kdWxlc19fKVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5tID0gbW9kdWxlcztcblxuIFx0Ly8gZXhwb3NlIHRoZSBtb2R1bGUgY2FjaGVcbiBcdF9fd2VicGFja19yZXF1aXJlX18uYyA9IGluc3RhbGxlZE1vZHVsZXM7XG5cbiBcdC8vIGRlZmluZSBnZXR0ZXIgZnVuY3Rpb24gZm9yIGhhcm1vbnkgZXhwb3J0c1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5kID0gZnVuY3Rpb24oZXhwb3J0cywgbmFtZSwgZ2V0dGVyKSB7XG4gXHRcdGlmKCFfX3dlYnBhY2tfcmVxdWlyZV9fLm8oZXhwb3J0cywgbmFtZSkpIHtcbiBcdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgbmFtZSwge1xuIFx0XHRcdFx0Y29uZmlndXJhYmxlOiBmYWxzZSxcbiBcdFx0XHRcdGVudW1lcmFibGU6IHRydWUsXG4gXHRcdFx0XHRnZXQ6IGdldHRlclxuIFx0XHRcdH0pO1xuIFx0XHR9XG4gXHR9O1xuXG4gXHQvLyBkZWZpbmUgX19lc01vZHVsZSBvbiBleHBvcnRzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLnIgPSBmdW5jdGlvbihleHBvcnRzKSB7XG4gXHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAnX19lc01vZHVsZScsIHsgdmFsdWU6IHRydWUgfSk7XG4gXHR9O1xuXG4gXHQvLyBnZXREZWZhdWx0RXhwb3J0IGZ1bmN0aW9uIGZvciBjb21wYXRpYmlsaXR5IHdpdGggbm9uLWhhcm1vbnkgbW9kdWxlc1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5uID0gZnVuY3Rpb24obW9kdWxlKSB7XG4gXHRcdHZhciBnZXR0ZXIgPSBtb2R1bGUgJiYgbW9kdWxlLl9fZXNNb2R1bGUgP1xuIFx0XHRcdGZ1bmN0aW9uIGdldERlZmF1bHQoKSB7IHJldHVybiBtb2R1bGVbJ2RlZmF1bHQnXTsgfSA6XG4gXHRcdFx0ZnVuY3Rpb24gZ2V0TW9kdWxlRXhwb3J0cygpIHsgcmV0dXJuIG1vZHVsZTsgfTtcbiBcdFx0X193ZWJwYWNrX3JlcXVpcmVfXy5kKGdldHRlciwgJ2EnLCBnZXR0ZXIpO1xuIFx0XHRyZXR1cm4gZ2V0dGVyO1xuIFx0fTtcblxuIFx0Ly8gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm8gPSBmdW5jdGlvbihvYmplY3QsIHByb3BlcnR5KSB7IHJldHVybiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob2JqZWN0LCBwcm9wZXJ0eSk7IH07XG5cbiBcdC8vIF9fd2VicGFja19wdWJsaWNfcGF0aF9fXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLnAgPSBcIlwiO1xuXG5cbiBcdC8vIExvYWQgZW50cnkgbW9kdWxlIGFuZCByZXR1cm4gZXhwb3J0c1xuIFx0cmV0dXJuIF9fd2VicGFja19yZXF1aXJlX18oX193ZWJwYWNrX3JlcXVpcmVfXy5zID0gNCk7XG4iLCJtb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uKCkge1xuICByZXR1cm4gbmV3IFdvcmtlcihfX3dlYnBhY2tfcHVibGljX3BhdGhfXyArIFwiZDNhYzFiNjMwMGNiNWVjNjY5YjYud29ya2VyLmpzXCIpO1xufTsiLCJleHBvcnQgZGVmYXVsdCBjbGFzcyBDb2xvclV0aWxzIHtcbiAgc3RhdGljIHJnYmFUb0NTUyhyZ2JhQ29sb3IpIHtcbiAgICBjb25zdCBhbHBoYSA9IHJnYmFDb2xvci5hIC8gMjU1O1xuICAgIHJldHVybiBgcmdiYSgke3JnYmFDb2xvci5yfSwgJHtyZ2JhQ29sb3IuZ30sICR7cmdiYUNvbG9yLmJ9LCAke2FscGhhLnRvRml4ZWQoMil9KWA7XG4gIH1cblxuICBzdGF0aWMgcmdiYVRvSGV4KHJnYmFDb2xvcikge1xuICAgIHJldHVybiBgIyR7dGhpcy5pbnRlZ2VyVG9IZXgocmdiYUNvbG9yLnIpfSR7dGhpcy5pbnRlZ2VyVG9IZXgocmdiYUNvbG9yLmcpfSR7dGhpcy5pbnRlZ2VyVG9IZXgocmdiYUNvbG9yLmIpfSR7dGhpcy5pbnRlZ2VyVG9IZXgocmdiYUNvbG9yLmEpfWA7XG4gIH1cblxuICBzdGF0aWMgaW50ZWdlclRvSGV4KGMpIHtcbiAgICBjb25zdCBoZXggPSBjLnRvU3RyaW5nKDE2KTtcbiAgICByZXR1cm4gaGV4Lmxlbmd0aCA9PT0gMSA/IGAwJHtoZXh9YCA6IGhleDtcbiAgfVxuXG4gIHN0YXRpYyBoZXhUb1JnYmEoaGV4KSB7XG4gICAgY29uc3QgcmVzdWx0ID0gL14jPyhbYS1mXFxkXXsyfSkoW2EtZlxcZF17Mn0pKFthLWZcXGRdezJ9KShbYS1mXFxkXXsyfSk/JC9pLmV4ZWMoaGV4KTtcblxuICAgIHJldHVybiByZXN1bHQgPyB7XG4gICAgICByOiBwYXJzZUludChyZXN1bHRbMV0sIDE2KSxcbiAgICAgIGc6IHBhcnNlSW50KHJlc3VsdFsyXSwgMTYpLFxuICAgICAgYjogcGFyc2VJbnQocmVzdWx0WzNdLCAxNiksXG4gICAgICBhOiBwYXJzZUludChyZXN1bHRbNF0sIDE2KSxcbiAgICB9IDogbnVsbDtcbiAgfVxuXG4gIHN0YXRpYyBldWNsaWRlYW5EaXN0YW5jZVNxdWFyZShsaXN0MSwgbGlzdDIpIHtcbiAgICBsZXQgc3VtID0gMDtcblxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbGlzdDEubGVuZ3RoOyBpICs9IDEpIHtcbiAgICAgIGNvbnN0IG9mZnNldCA9IGxpc3QxW2ldIC0gbGlzdDJbaV07XG4gICAgICBzdW0gKz0gb2Zmc2V0ICogb2Zmc2V0O1xuICAgIH1cblxuICAgIHJldHVybiBzdW07XG4gIH1cblxuICBzdGF0aWMgaGV4U2ltaWxhcml0eShoZXgxLCBoZXgyKSB7XG4gICAgcmV0dXJuIHRoaXMucmdiU2ltaWxhcml0eSh0aGlzLmhleFRvUmdiYShoZXgxKSwgdGhpcy5oZXhUb1JnYmEoaGV4MikpO1xuICB9XG5cbiAgc3RhdGljIHJnYlNpbWlsYXJpdHkocmdiMSwgcmdiMikge1xuICAgIGlmICghdGhpcy5SR0JfTUFYX0RJU1RBTkNFX1NRVUFSRSkge1xuICAgICAgdGhpcy5SR0JfTUFYX0RJU1RBTkNFX1NRVUFSRSA9XG4gICAgICAgIHRoaXMuZXVjbGlkZWFuRGlzdGFuY2VTcXVhcmUoWzI1NSwgMjU1LCAyNTUsIDI1NV0sIFswLCAwLCAwLCAwXSk7XG4gICAgfVxuICAgIGNvbnN0IGRpc3RhbmNlID0gdGhpcy5ldWNsaWRlYW5EaXN0YW5jZVNxdWFyZShbXG4gICAgICByZ2IxLnIsXG4gICAgICByZ2IxLmcsXG4gICAgICByZ2IxLmIsXG4gICAgICByZ2IxLmEsXG4gICAgXSwgW1xuICAgICAgcmdiMi5yLFxuICAgICAgcmdiMi5nLFxuICAgICAgcmdiMi5iLFxuICAgICAgcmdiMi5hLFxuICAgIF0pO1xuXG4gICAgcmV0dXJuIDEgLSBNYXRoLnNxcnQoZGlzdGFuY2UgLyB0aGlzLlJHQl9NQVhfRElTVEFOQ0VfU1FVQVJFKTtcbiAgfVxufVxuIiwiZXhwb3J0IGRlZmF1bHQgY2xhc3MgUGVyZiB7XG4gIGNvbnN0cnVjdG9yKHBlcmZvcm1hbmNlID0gJ1BlcmZvcm1hbmNlJykge1xuICAgIHRoaXMucGVyZm9ybWFuY2UgPSBwZXJmb3JtYW5jZTtcbiAgfVxuXG4gIHN0YXJ0RXhlY3V0aW9uKCkge1xuICAgIHRoaXMuc3RhcnRUaW1lID0gcGVyZm9ybWFuY2Uubm93KCk7XG4gIH1cblxuICBzdG9wRXhlY3V0aW9uKCkge1xuICAgIHRoaXMuZW5kVGltZSA9IHBlcmZvcm1hbmNlLm5vdygpO1xuICB9XG5cbiAgZ2V0RXhlY3V0aW9uRHVyYXRpb24oKSB7XG4gICAgY29uc3QgdGltZSA9ICh0aGlzLmVuZFRpbWUgLSB0aGlzLnN0YXJ0VGltZSkgLyAxMDAwO1xuICAgIHJldHVybiB0aW1lLnRvRml4ZWQoMyk7XG4gIH1cblxuICBsb2coKSB7XG4gICAgY29uc29sZS5pbmZvKGAke3RoaXMucGVyZm9ybWFuY2V9IDogJHt0aGlzLmdldEV4ZWN1dGlvbkR1cmF0aW9uKCl9IHNlY29uZGVzLmApO1xuICB9XG59XG4iLCJpbXBvcnQgUGVyZiBmcm9tICcuL3BlcmYnO1xuaW1wb3J0IENvbG9yVXRpbHMgZnJvbSAnLi9jb2xvci11dGlscyc7XG5pbXBvcnQgV29ya2VyIGZyb20gJy4vYW5hbHlzZS1waWN0dXJlLndvcmtlcic7XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIEFuYWx5c2VQaXhlbHMge1xuICBzdGF0aWMgaW5pdCgpIHtcbiAgICB0aGlzLiRib2R5ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignYm9keScpO1xuICAgIHRoaXMuJGZvcm0gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYW5hbHlzZUZvcm0nKTtcbiAgICB0aGlzLiRpbnB1dEltYWdlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3VwbG9hZEltYWdlJyk7XG4gICAgdGhpcy4kaW5wdXRUaHJlc2hvbGQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndGhyZXNob2xkJyk7XG4gICAgdGhpcy4kaW1hZ2VEaXNwbGF5ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Rpc3BsYXktaW1hZ2UnKTtcbiAgICB0aGlzLiRpbWFnZUFuYWx5c2UgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYW5hbHlzZS1pbWFnZScpO1xuICAgIHRoaXMuJGltYWdlQ29udGFpbmVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmltYWdlLWNvbnRhaW5lcicpO1xuICAgIHRoaXMuJHNpemVCbG9jayA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzaXplLWJsb2NrJyk7XG4gICAgdGhpcy4kY2FudmFzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NhbnZhcycpO1xuICAgIHRoaXMuJHByb2dyZXNzQmFyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Byb2dyZXNzQmFyJyk7XG4gICAgdGhpcy4kcHJvZ3Jlc3NTY2FuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnByb2dyZXNzLXNjYW4nKTtcbiAgICB0aGlzLiRyZXN1bHRzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnJlc3VsdGF0cycpO1xuXG4gICAgdGhpcy4kZm9ybS5hZGRFdmVudExpc3RlbmVyKCdzdWJtaXQnLCAoc3VibWl0RXZlbnQpID0+IHtcbiAgICAgIHN1Ym1pdEV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG5cbiAgICAgIHRoaXMudGhyZXNob2xkID0gdGhpcy4kaW5wdXRUaHJlc2hvbGQudmFsdWUgPyBNYXRoLnJvdW5kKHRoaXMuJGlucHV0VGhyZXNob2xkLnZhbHVlKSA6IDkwO1xuXG4gICAgICBpZiAodGhpcy50aHJlc2hvbGQgPCAwIHx8IHRoaXMudGhyZXNob2xkID4gMTAwKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgdGhpcy50aHJlc2hvbGQgPSB0aGlzLnRocmVzaG9sZCAvIDEwMDtcblxuICAgICAgdGhpcy5zdGFydEFuYWx5c2luZygpO1xuICAgIH0pO1xuXG4gICAgdGhpcy4kaW5wdXRJbWFnZS5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCAoKSA9PiB7XG4gICAgICB0aGlzLmxvYWRJbWFnZSgpO1xuICAgIH0pO1xuICB9XG5cbiAgc3RhdGljIHN0YXJ0TG9hZGluZygpIHtcbiAgICB0aGlzLiRyZXN1bHRzLmlubmVySFRNTCA9ICcnO1xuICAgIHRoaXMuJGJvZHkuY2xhc3NMaXN0LmFkZCgnaXMtbG9hZGluZycpO1xuICAgIHRoaXMuc2V0UHJvZ3Jlc3MoMCk7XG4gIH1cblxuICBzdGF0aWMgc3RvcExvYWRpbmcoKSB7XG4gICAgdGhpcy4kYm9keS5jbGFzc0xpc3QucmVtb3ZlKCdpcy1sb2FkaW5nJyk7XG4gICAgdGhpcy5zZXRQcm9ncmVzcygwKTtcbiAgfVxuXG4gIHN0YXRpYyBzZXRQcm9ncmVzcyhwZXJjZW50YWdlKSB7XG4gICAgY29uc3QgcGVyY2VudFN0cmluZyA9IGAke3BlcmNlbnRhZ2V9JWA7XG4gICAgdGhpcy4kcHJvZ3Jlc3NCYXIuc3R5bGUud2lkdGggPSBwZXJjZW50U3RyaW5nO1xuICAgIHRoaXMuJHByb2dyZXNzQmFyLmlubmVySFRNTCA9IHBlcmNlbnRTdHJpbmc7XG4gICAgdGhpcy4kcHJvZ3Jlc3NTY2FuLnN0eWxlLmhlaWdodCA9IHBlcmNlbnRTdHJpbmc7XG4gIH1cblxuICBzdGF0aWMgc3RhcnRBbmFseXNpbmcoKSB7XG4gICAgdGhpcy5zdGFydExvYWRpbmcoKTtcblxuICAgIGNvbnN0IGltYWdlRGF0YSA9IHRoaXMuZ2V0SW1hZ2VEYXRhKCk7XG5cbiAgICBjb25zdCB3b3JrZXIgPSBuZXcgV29ya2VyKCk7XG5cbiAgICBjb25zdCBhbmFseXNlUGVyZiA9IG5ldyBQZXJmKCdUZW1wcyBkZSBjYWxjdWwnKTtcbiAgICBhbmFseXNlUGVyZi5zdGFydEV4ZWN1dGlvbigpO1xuXG4gICAgd29ya2VyLnBvc3RNZXNzYWdlKHtcbiAgICAgIGltYWdlRGF0YSxcbiAgICAgIHNpbWlsYXJpdHlUaHJlc2hvbGQ6IHRoaXMudGhyZXNob2xkLFxuICAgIH0pO1xuXG4gICAgd29ya2VyLmFkZEV2ZW50TGlzdGVuZXIoJ21lc3NhZ2UnLCAoeyBkYXRhIH0pID0+IHtcbiAgICAgIGlmIChkYXRhLnR5cGUgJiYgZGF0YS50eXBlID09PSAncHJvZ3Jlc3MnKSB7XG4gICAgICAgIHRoaXMuc2V0UHJvZ3Jlc3MoZGF0YS5wZXJjZW50YWdlKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICBhbmFseXNlUGVyZi5zdG9wRXhlY3V0aW9uKCk7XG4gICAgICBhbmFseXNlUGVyZi5sb2coKTtcblxuICAgICAgY29uc3QgYW5hbHlzZWRDb2xvcnMgPSBkYXRhLnByb2Nlc3NlZERhdGE7XG5cbiAgICAgIGNvbnN0IGRpc3BsYXlQZXJmID0gbmV3IFBlcmYoJ1RlbXBzIGRcXCdhZmZpY2hhZ2UgZGVzIHLDqXN1bHRhdHMnKTtcbiAgICAgIGRpc3BsYXlQZXJmLnN0YXJ0RXhlY3V0aW9uKCk7XG4gICAgICB0aGlzLmRpc3BsYXlSZXN1bHRzKGFuYWx5c2VkQ29sb3JzKTtcbiAgICAgIGRpc3BsYXlQZXJmLnN0b3BFeGVjdXRpb24oKTtcbiAgICAgIGRpc3BsYXlQZXJmLmxvZygpO1xuXG4gICAgICB0aGlzLnN0b3BMb2FkaW5nKCk7XG4gICAgICB3b3JrZXIudGVybWluYXRlKCk7XG4gICAgfSk7XG4gIH1cblxuICBzdGF0aWMgZ2V0SW1hZ2VEYXRhKCkge1xuICAgIGNvbnN0IGNvbnRleHQgPSB0aGlzLiRjYW52YXMuZ2V0Q29udGV4dCgnMmQnKTtcbiAgICBjb25zdCB7XG4gICAgICB3aWR0aCxcbiAgICAgIGhlaWdodCxcbiAgICB9ID0gdGhpcy4kaW1hZ2VBbmFseXNlO1xuXG4gICAgdGhpcy4kY2FudmFzLmhlaWdodCA9IGhlaWdodDtcbiAgICB0aGlzLiRjYW52YXMud2lkdGggPSB3aWR0aDtcblxuICAgIGNvbnRleHQuZHJhd0ltYWdlKHRoaXMuJGltYWdlQW5hbHlzZSwgMCwgMCk7XG4gICAgY29uc3QgaW1hZ2VEYXRhID0gY29udGV4dC5nZXRJbWFnZURhdGEoMCwgMCwgd2lkdGgsIGhlaWdodCkuZGF0YTtcbiAgICByZXR1cm4gaW1hZ2VEYXRhO1xuICB9XG5cbiAgc3RhdGljIGRpc3BsYXlSZXN1bHRzKGFuYWx5c2VkQ29sb3JzKSB7XG4gICAgY29uc3QgZnJhZ21lbnQgPSBkb2N1bWVudC5jcmVhdGVEb2N1bWVudEZyYWdtZW50KCk7XG5cbiAgICBjb25zdCBjb2xvcnNUb0Rpc3BsYXkgPSBhbmFseXNlZENvbG9yc1xuICAgICAgLnNvcnQoKGEsIGIpID0+IGIuY291bnQgLSBhLmNvdW50KVxuICAgICAgLnNwbGljZSgwLCAxMDAwKTtcblxuICAgIGNvbG9yc1RvRGlzcGxheS5mb3JFYWNoKChjb2xvckRhdGEpID0+IHtcbiAgICAgIGNvbnN0IGNzc0NvbG9yID0gQ29sb3JVdGlscy5yZ2JhVG9DU1MoQ29sb3JVdGlscy5oZXhUb1JnYmEoY29sb3JEYXRhLmNvbG9yKSk7XG4gICAgICBjb25zdCBsaSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2xpJyk7XG4gICAgICBsaS5pbm5lckhUTUwgPSBgPGRpdiBjbGFzcz1cImNvbG9yLWNvbnRhaW5lclwiPjxzcGFuIGNsYXNzPVwiY29sb3JcIiBzdHlsZT1cImJhY2tncm91bmQtY29sb3I6ICR7Y3NzQ29sb3J9O1wiPjwvc3Bhbj48c3BhbiBjbGFzcz1cImNvbG9yLXRleHRcIj4ke2Nzc0NvbG9yfTwvc3Bhbj48L2Rpdj4gJHtjb2xvckRhdGEuY291bnR9YDtcblxuICAgICAgZnJhZ21lbnQuYXBwZW5kQ2hpbGQobGkpO1xuICAgIH0pO1xuXG4gICAgdGhpcy4kcmVzdWx0cy5hcHBlbmRDaGlsZChmcmFnbWVudCk7XG4gIH1cblxuICBzdGF0aWMgbG9hZEltYWdlKCkge1xuICAgIGNvbnN0IHtcbiAgICAgIGZpbGVzLFxuICAgIH0gPSB0aGlzLiRpbnB1dEltYWdlO1xuXG4gICAgaWYgKEZpbGVSZWFkZXIgJiYgZmlsZXMgJiYgZmlsZXMubGVuZ3RoKSB7XG4gICAgICBjb25zdCBmaWxlUmVhZGVyID0gbmV3IEZpbGVSZWFkZXIoKTtcblxuICAgICAgZmlsZVJlYWRlci5vbmxvYWQgPSAoKSA9PiB7XG4gICAgICAgIHRoaXMuJGltYWdlRGlzcGxheS5zcmMgPSBmaWxlUmVhZGVyLnJlc3VsdDtcbiAgICAgICAgdGhpcy4kaW1hZ2VBbmFseXNlLnNyYyA9IGZpbGVSZWFkZXIucmVzdWx0O1xuICAgICAgfTtcbiAgICAgIGZpbGVSZWFkZXIucmVhZEFzRGF0YVVSTChmaWxlc1swXSk7XG5cbiAgICAgIHRoaXMuJGltYWdlQW5hbHlzZS5vbmxvYWQgPSAoKSA9PiB7XG4gICAgICAgIHRoaXMuZGlzcGxheUltYWdlKCk7XG4gICAgICAgIHRoaXMuZGlzcGxheUltYWdlU2l6ZSgpO1xuICAgICAgfTtcbiAgICB9XG4gIH1cblxuICBzdGF0aWMgZGlzcGxheUltYWdlKCkge1xuICAgIHRoaXMuJGltYWdlQ29udGFpbmVyLmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGRlbicpO1xuICB9XG5cbiAgc3RhdGljIGRpc3BsYXlJbWFnZVNpemUoKSB7XG4gICAgdGhpcy4kc2l6ZUJsb2NrLmlubmVySFRNTCA9IGBUYWlsbGUgZGUgbCdpbWFnZSA6ICR7dGhpcy4kaW1hZ2VBbmFseXNlLmhlaWdodH14JHt0aGlzLiRpbWFnZUFuYWx5c2Uud2lkdGh9IHBpeGVscy5gO1xuICB9XG59XG4iLCJpbXBvcnQgJy4vc3R5bGUuc2Nzcyc7XG5pbXBvcnQgQW5hbHlzZVBpeGVscyBmcm9tICcuL2pzL2FuYWx5c2UtcGl4ZWxzJztcblxuZnVuY3Rpb24gZG9tUmVhZHkoY2FsbGJhY2spIHtcbiAgaWYgKGRvY3VtZW50LmF0dGFjaEV2ZW50ID8gZG9jdW1lbnQucmVhZHlTdGF0ZSA9PT0gJ2NvbXBsZXRlJyA6IGRvY3VtZW50LnJlYWR5U3RhdGUgIT09ICdsb2FkaW5nJykge1xuICAgIGNhbGxiYWNrKCk7XG4gIH0gZWxzZSB7XG4gICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignRE9NQ29udGVudExvYWRlZCcsIGNhbGxiYWNrKTtcbiAgfVxufVxuXG5kb21SZWFkeSgoKSA9PiB7XG4gIEFuYWx5c2VQaXhlbHMuaW5pdCgpO1xuXG4gIGlmICgnc2VydmljZVdvcmtlcicgaW4gbmF2aWdhdG9yKSB7XG4gICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ2xvYWQnLCAoKSA9PiB7XG4gICAgICBuYXZpZ2F0b3Iuc2VydmljZVdvcmtlci5yZWdpc3Rlcignc3cuanMnKS50aGVuKChyZWdpc3RyYXRpb24pID0+IHtcbiAgICAgICAgY29uc29sZS5sb2coJ1NXIHJlZ2lzdGVyZWQ6ICcsIHJlZ2lzdHJhdGlvbik7XG4gICAgICB9KS5jYXRjaCgocmVnaXN0cmF0aW9uRXJyb3IpID0+IHtcbiAgICAgICAgY29uc29sZS5sb2coJ1NXIHJlZ2lzdHJhdGlvbiBmYWlsZWQ6ICcsIHJlZ2lzdHJhdGlvbkVycm9yKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9XG59KTtcbiJdLCJzb3VyY2VSb290IjoiIn0=