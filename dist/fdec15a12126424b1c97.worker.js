!function(e){var t={};function n(r){if(t[r])return t[r].exports;var a=t[r]={i:r,l:!1,exports:{}};return e[r].call(a.exports,a,a.exports,n),a.l=!0,a.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:r})},n.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=2)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r,a=(r=n(1))&&r.__esModule?r:{default:r};function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var i=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,r;return t=e,r=[{key:"getColorFromArray",value:function(e,t){return a.default.rgbaToHex({r:e[t],g:e[t+1],b:e[t+2],a:e[t+3]})}},{key:"countColors",value:function(e){for(var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.9,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){},o=[],i=function(i){var u=t.getColorFromArray(e,i),c=o.find(function(e){return a.default.hexSimilarity(e.color,u)>=n});c?c.count+=1:o.push({color:u,count:1}),r(i/4)},u=0;u<e.length;u+=4)i(u);return o}}],(n=null)&&o(t.prototype,n),r&&o(t,r),e}();t.default=i},function(e,t,n){"use strict";function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,a;return t=e,a=[{key:"rgbaToCSS",value:function(e){return"rgba(".concat(e.r,", ").concat(e.g,", ").concat(e.b,", ").concat(e.a,")")}},{key:"rgbaToHex",value:function(e){return"#".concat(this.integerToHex(e.r)).concat(this.integerToHex(e.g)).concat(this.integerToHex(e.b)).concat(this.integerToHex(e.a))}},{key:"integerToHex",value:function(e){var t=e.toString(16);return 1===t.length?"0".concat(t):t}},{key:"hexToRgba",value:function(e){var t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})?$/i.exec(e);return t?{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16),a:parseInt(t[4],16)}:null}},{key:"euclideanDistanceSquare",value:function(e,t){for(var n=0,r=0;r<e.length;r+=1){var a=e[r]-t[r];n+=a*a}return n}},{key:"hexSimilarity",value:function(e,t){return this.rgbSimilarity(this.hexToRgba(e),this.hexToRgba(t))}},{key:"rgbSimilarity",value:function(e,t){this.RGB_MAX_DISTANCE_SQUARE||(this.RGB_MAX_DISTANCE_SQUARE=this.euclideanDistanceSquare([255,255,255],[0,0,0]));var n=this.euclideanDistanceSquare([e.r,e.g,e.b],[t.r,t.g,t.b]);return 1-Math.sqrt(n/this.RGB_MAX_DISTANCE_SQUARE)}}],(n=null)&&r(t.prototype,n),a&&r(t,a),e}();t.default=a},function(e,t,n){"use strict";n.r(t);var r=n(0),a=n.n(r);self.addEventListener("message",({data:e})=>{const{imageData:t,similarityThreshold:n}=e,r=t.length/4,o=r/100;console.log(r,o);const i=a.a.countColors(t,n,e=>{e%o==0&&self.postMessage({type:"progress",percentage:e/o+1})});self.postMessage({processedData:i})})}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vd2VicGFjay9ib290c3RyYXAiLCJ3ZWJwYWNrOi8vLy4vc3JjL2pzL2ltYWdlLXByb2Nlc3NpbmcuanMiLCJ3ZWJwYWNrOi8vLy4vc3JjL2pzL2NvbG9yLXV0aWxzLmpzIiwid2VicGFjazovLy8uL3NyYy9qcy9hbmFseXNlLXBpY3R1cmUud29ya2VyLmpzIl0sIm5hbWVzIjpbImluc3RhbGxlZE1vZHVsZXMiLCJfX3dlYnBhY2tfcmVxdWlyZV9fIiwibW9kdWxlSWQiLCJleHBvcnRzIiwibW9kdWxlIiwiaSIsImwiLCJtb2R1bGVzIiwiY2FsbCIsIm0iLCJjIiwiZCIsIm5hbWUiLCJnZXR0ZXIiLCJvIiwiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJjb25maWd1cmFibGUiLCJlbnVtZXJhYmxlIiwiZ2V0IiwiciIsInZhbHVlIiwibiIsIl9fZXNNb2R1bGUiLCJvYmplY3QiLCJwcm9wZXJ0eSIsInByb3RvdHlwZSIsImhhc093blByb3BlcnR5IiwicCIsInMiLCJfY29sb3JVdGlscyIsIkltYWdlUHJvY2Vzc2luZyIsImRhdGEiLCJzdGFydEluZGV4IiwiQ29sb3JVdGlscyIsInJnYmFUb0hleCIsImciLCJiIiwiYSIsImltYWdlRGF0YSIsIl90aGlzIiwidGhpcyIsInNpbWlsYXJpdHlUaHJlc2hvbGQiLCJhcmd1bWVudHMiLCJsZW5ndGgiLCJ1bmRlZmluZWQiLCJvblByb2dyZXNzIiwicmVzdWx0IiwiX2xvb3AiLCJoZXhDb2xvciIsImdldENvbG9yRnJvbUFycmF5IiwiZXhpc3RpbmdDb2xvciIsImZpbmQiLCJoZXhTaW1pbGFyaXR5IiwiY29sb3IiLCJjb3VudCIsInB1c2giLCJyZ2JhQ29sb3IiLCJjb25jYXQiLCJpbnRlZ2VyVG9IZXgiLCJoZXgiLCJ0b1N0cmluZyIsImV4ZWMiLCJwYXJzZUludCIsImxpc3QxIiwibGlzdDIiLCJzdW0iLCJvZmZzZXQiLCJoZXgxIiwiaGV4MiIsInJnYlNpbWlsYXJpdHkiLCJoZXhUb1JnYmEiLCJyZ2IxIiwicmdiMiIsIlJHQl9NQVhfRElTVEFOQ0VfU1FVQVJFIiwiZXVjbGlkZWFuRGlzdGFuY2VTcXVhcmUiLCJkaXN0YW5jZSIsIk1hdGgiLCJzcXJ0IiwiX2ltYWdlX3Byb2Nlc3NpbmdfX1dFQlBBQ0tfSU1QT1JURURfTU9EVUxFXzBfXyIsIl9pbWFnZV9wcm9jZXNzaW5nX19XRUJQQUNLX0lNUE9SVEVEX01PRFVMRV8wX19fZGVmYXVsdCIsInNlbGYiLCJhZGRFdmVudExpc3RlbmVyIiwidG90YWxQaXhlbHMiLCJzdGVwIiwiY29uc29sZSIsImxvZyIsInByb2Nlc3NlZERhdGEiLCJjb3VudENvbG9ycyIsImluZGV4IiwicG9zdE1lc3NhZ2UiLCJ0eXBlIiwicGVyY2VudGFnZSJdLCJtYXBwaW5ncyI6ImFBQ0EsSUFBQUEsS0FHQSxTQUFBQyxFQUFBQyxHQUdBLEdBQUFGLEVBQUFFLEdBQ0EsT0FBQUYsRUFBQUUsR0FBQUMsUUFHQSxJQUFBQyxFQUFBSixFQUFBRSxJQUNBRyxFQUFBSCxFQUNBSSxHQUFBLEVBQ0FILFlBVUEsT0FOQUksRUFBQUwsR0FBQU0sS0FBQUosRUFBQUQsUUFBQUMsSUFBQUQsUUFBQUYsR0FHQUcsRUFBQUUsR0FBQSxFQUdBRixFQUFBRCxRQUtBRixFQUFBUSxFQUFBRixFQUdBTixFQUFBUyxFQUFBVixFQUdBQyxFQUFBVSxFQUFBLFNBQUFSLEVBQUFTLEVBQUFDLEdBQ0FaLEVBQUFhLEVBQUFYLEVBQUFTLElBQ0FHLE9BQUFDLGVBQUFiLEVBQUFTLEdBQ0FLLGNBQUEsRUFDQUMsWUFBQSxFQUNBQyxJQUFBTixLQU1BWixFQUFBbUIsRUFBQSxTQUFBakIsR0FDQVksT0FBQUMsZUFBQWIsRUFBQSxjQUFpRGtCLE9BQUEsS0FJakRwQixFQUFBcUIsRUFBQSxTQUFBbEIsR0FDQSxJQUFBUyxFQUFBVCxLQUFBbUIsV0FDQSxXQUEyQixPQUFBbkIsRUFBQSxTQUMzQixXQUFpQyxPQUFBQSxHQUVqQyxPQURBSCxFQUFBVSxFQUFBRSxFQUFBLElBQUFBLEdBQ0FBLEdBSUFaLEVBQUFhLEVBQUEsU0FBQVUsRUFBQUMsR0FBc0QsT0FBQVYsT0FBQVcsVUFBQUMsZUFBQW5CLEtBQUFnQixFQUFBQyxJQUd0RHhCLEVBQUEyQixFQUFBLEdBSUEzQixJQUFBNEIsRUFBQSxvR0NuRUEsTUFBQUMsS0FBQTdCLEVBQUEsME1BRXFCOEIsZ01BQ01DLEVBQU1DLEdBQzdCLE9BQU9DLFVBQVdDLFdBQ2hCZixFQUFHWSxFQUFLQyxHQUNSRyxFQUFHSixFQUFLQyxFQUFhLEdBQ3JCSSxFQUFHTCxFQUFLQyxFQUFhLEdBQ3JCSyxFQUFHTixFQUFLQyxFQUFhLHlDQUlOTSxHQUdqQixJQUg4RSxJQUFBQyxFQUFBQyxLQUFsREMsRUFBa0RDLFVBQUFDLE9BQUEsUUFBQUMsSUFBQUYsVUFBQSxHQUFBQSxVQUFBLEdBQTVCLEdBQUtHLEVBQXVCSCxVQUFBQyxPQUFBLFFBQUFDLElBQUFGLFVBQUEsR0FBQUEsVUFBQSxHQUFWLGFBQzlESSxLQUR3RUMsRUFBQSxTQUdyRTNDLEdBQ1AsSUFBTTRDLEVBQVdULEVBQUtVLGtCQUFrQlgsRUFBV2xDLEdBRTdDOEMsRUFBZ0JKLEVBQU9LLEtBQUssU0FBQXBCLEdBQUEsT0FBUUUsVUFDdkNtQixjQUFjckIsRUFBS3NCLE1BQU9MLElBQWFQLElBRXJDUyxFQU1IQSxFQUFjSSxPQUFTLEVBTHZCUixFQUFPUyxNQUNMRixNQUFPTCxFQUNQTSxNQUFPLElBS1hULEVBQVd6QyxFQUFJLElBZFJBLEVBQUksRUFBR0EsRUFBSWtDLEVBQVVLLE9BQVF2QyxHQUFLLEVBQUcyQyxFQUFyQzNDLEdBaUJULE9BQU8wQyxxVUNoQ1ViLHdMQUNGdUIsR0FDZixjQUFBQyxPQUFlRCxFQUFVckMsRUFBekIsTUFBQXNDLE9BQStCRCxFQUFVckIsRUFBekMsTUFBQXNCLE9BQStDRCxFQUFVcEIsRUFBekQsTUFBQXFCLE9BQStERCxFQUFVbkIsRUFBekUsdUNBR2VtQixHQUNmLFVBQUFDLE9BQVdqQixLQUFLa0IsYUFBYUYsRUFBVXJDLElBQXZDc0MsT0FBNENqQixLQUFLa0IsYUFBYUYsRUFBVXJCLElBQXhFc0IsT0FBNkVqQixLQUFLa0IsYUFBYUYsRUFBVXBCLElBQXpHcUIsT0FBOEdqQixLQUFLa0IsYUFBYUYsRUFBVW5CLHlDQUd4SDVCLEdBQ2xCLElBQU1rRCxFQUFNbEQsRUFBRW1ELFNBQVMsSUFDdkIsT0FBc0IsSUFBZkQsRUFBSWhCLE9BQUosSUFBQWMsT0FBdUJFLEdBQVFBLG9DQUd2QkEsR0FDZixJQUFNYixFQUFTLHlEQUF5RGUsS0FBS0YsR0FFN0UsT0FBT2IsR0FDTDNCLEVBQUcyQyxTQUFTaEIsRUFBTyxHQUFJLElBQ3ZCWCxFQUFHMkIsU0FBU2hCLEVBQU8sR0FBSSxJQUN2QlYsRUFBRzBCLFNBQVNoQixFQUFPLEdBQUksSUFDdkJULEVBQUd5QixTQUFTaEIsRUFBTyxHQUFJLEtBQ3JCLHFEQUl5QmlCLEVBQU9DLEdBR3BDLElBRkEsSUFBSUMsRUFBTSxFQUVEN0QsRUFBSSxFQUFHQSxFQUFJMkQsRUFBTXBCLE9BQVF2QyxHQUFLLEVBQUcsQ0FDeEMsSUFBTThELEVBQVNILEVBQU0zRCxHQUFLNEQsRUFBTTVELEdBQ2hDNkQsR0FBT0MsRUFBU0EsRUFHbEIsT0FBT0Qsd0NBRVlFLEVBQU1DLEdBQ3pCLE9BQU81QixLQUFLNkIsY0FBYzdCLEtBQUs4QixVQUFVSCxHQUFPM0IsS0FBSzhCLFVBQVVGLDBDQUc1Q0csRUFBTUMsR0FDcEJoQyxLQUFLaUMsMEJBQ1JqQyxLQUFLaUMsd0JBQTBCakMsS0FBS2tDLHlCQUF5QixJQUFLLElBQUssTUFBTyxFQUFHLEVBQUcsS0FFdEYsSUFBTUMsRUFBV25DLEtBQUtrQyx5QkFDcEJILEVBQUtwRCxFQUNMb0QsRUFBS3BDLEVBQ0xvQyxFQUFLbkMsSUFFTG9DLEVBQUtyRCxFQUNMcUQsRUFBS3JDLEVBQ0xxQyxFQUFLcEMsSUFHUCxPQUFPLEVBQUl3QyxLQUFLQyxLQUFLRixFQUFXbkMsS0FBS2lDLHVIQ3REekMsSUFBQUssRUFBQTlFLEVBQUEsR0FBQStFLEVBQUEvRSxFQUFBcUIsRUFBQXlELEdBR0FFLEtBQUFDLGlCQUFBLFlBQW1DbEQsV0FDbkMsTUFBQU8sVUFDQUEsRUFBQUcsb0JBQ0FBLEdBQ0dWLEVBRUhtRCxFQUFBNUMsRUFBQUssT0FBQSxFQUNBd0MsRUFBQUQsRUFBQSxJQUVBRSxRQUFBQyxJQUFBSCxFQUFBQyxHQUVBLE1BQUFHLEVBQUFQLEVBQUExQyxFQUFBa0QsWUFBQWpELEVBQUFHLEVBQUErQyxJQUNBQSxFQUFBTCxHQUFBLEdBQ0FILEtBQUFTLGFBQXdCQyxLQUFBLFdBQUFDLFdBQUFILEVBQUFMLEVBQUEsTUFJeEJILEtBQUFTLGFBQW9CSCIsImZpbGUiOiJmZGVjMTVhMTIxMjY0MjRiMWM5Ny53b3JrZXIuanMiLCJzb3VyY2VzQ29udGVudCI6WyIgXHQvLyBUaGUgbW9kdWxlIGNhY2hlXG4gXHR2YXIgaW5zdGFsbGVkTW9kdWxlcyA9IHt9O1xuXG4gXHQvLyBUaGUgcmVxdWlyZSBmdW5jdGlvblxuIFx0ZnVuY3Rpb24gX193ZWJwYWNrX3JlcXVpcmVfXyhtb2R1bGVJZCkge1xuXG4gXHRcdC8vIENoZWNrIGlmIG1vZHVsZSBpcyBpbiBjYWNoZVxuIFx0XHRpZihpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXSkge1xuIFx0XHRcdHJldHVybiBpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXS5leHBvcnRzO1xuIFx0XHR9XG4gXHRcdC8vIENyZWF0ZSBhIG5ldyBtb2R1bGUgKGFuZCBwdXQgaXQgaW50byB0aGUgY2FjaGUpXG4gXHRcdHZhciBtb2R1bGUgPSBpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXSA9IHtcbiBcdFx0XHRpOiBtb2R1bGVJZCxcbiBcdFx0XHRsOiBmYWxzZSxcbiBcdFx0XHRleHBvcnRzOiB7fVxuIFx0XHR9O1xuXG4gXHRcdC8vIEV4ZWN1dGUgdGhlIG1vZHVsZSBmdW5jdGlvblxuIFx0XHRtb2R1bGVzW21vZHVsZUlkXS5jYWxsKG1vZHVsZS5leHBvcnRzLCBtb2R1bGUsIG1vZHVsZS5leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKTtcblxuIFx0XHQvLyBGbGFnIHRoZSBtb2R1bGUgYXMgbG9hZGVkXG4gXHRcdG1vZHVsZS5sID0gdHJ1ZTtcblxuIFx0XHQvLyBSZXR1cm4gdGhlIGV4cG9ydHMgb2YgdGhlIG1vZHVsZVxuIFx0XHRyZXR1cm4gbW9kdWxlLmV4cG9ydHM7XG4gXHR9XG5cblxuIFx0Ly8gZXhwb3NlIHRoZSBtb2R1bGVzIG9iamVjdCAoX193ZWJwYWNrX21vZHVsZXNfXylcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubSA9IG1vZHVsZXM7XG5cbiBcdC8vIGV4cG9zZSB0aGUgbW9kdWxlIGNhY2hlXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLmMgPSBpbnN0YWxsZWRNb2R1bGVzO1xuXG4gXHQvLyBkZWZpbmUgZ2V0dGVyIGZ1bmN0aW9uIGZvciBoYXJtb255IGV4cG9ydHNcbiBcdF9fd2VicGFja19yZXF1aXJlX18uZCA9IGZ1bmN0aW9uKGV4cG9ydHMsIG5hbWUsIGdldHRlcikge1xuIFx0XHRpZighX193ZWJwYWNrX3JlcXVpcmVfXy5vKGV4cG9ydHMsIG5hbWUpKSB7XG4gXHRcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIG5hbWUsIHtcbiBcdFx0XHRcdGNvbmZpZ3VyYWJsZTogZmFsc2UsXG4gXHRcdFx0XHRlbnVtZXJhYmxlOiB0cnVlLFxuIFx0XHRcdFx0Z2V0OiBnZXR0ZXJcbiBcdFx0XHR9KTtcbiBcdFx0fVxuIFx0fTtcblxuIFx0Ly8gZGVmaW5lIF9fZXNNb2R1bGUgb24gZXhwb3J0c1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5yID0gZnVuY3Rpb24oZXhwb3J0cykge1xuIFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgJ19fZXNNb2R1bGUnLCB7IHZhbHVlOiB0cnVlIH0pO1xuIFx0fTtcblxuIFx0Ly8gZ2V0RGVmYXVsdEV4cG9ydCBmdW5jdGlvbiBmb3IgY29tcGF0aWJpbGl0eSB3aXRoIG5vbi1oYXJtb255IG1vZHVsZXNcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubiA9IGZ1bmN0aW9uKG1vZHVsZSkge1xuIFx0XHR2YXIgZ2V0dGVyID0gbW9kdWxlICYmIG1vZHVsZS5fX2VzTW9kdWxlID9cbiBcdFx0XHRmdW5jdGlvbiBnZXREZWZhdWx0KCkgeyByZXR1cm4gbW9kdWxlWydkZWZhdWx0J107IH0gOlxuIFx0XHRcdGZ1bmN0aW9uIGdldE1vZHVsZUV4cG9ydHMoKSB7IHJldHVybiBtb2R1bGU7IH07XG4gXHRcdF9fd2VicGFja19yZXF1aXJlX18uZChnZXR0ZXIsICdhJywgZ2V0dGVyKTtcbiBcdFx0cmV0dXJuIGdldHRlcjtcbiBcdH07XG5cbiBcdC8vIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbFxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5vID0gZnVuY3Rpb24ob2JqZWN0LCBwcm9wZXJ0eSkgeyByZXR1cm4gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG9iamVjdCwgcHJvcGVydHkpOyB9O1xuXG4gXHQvLyBfX3dlYnBhY2tfcHVibGljX3BhdGhfX1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5wID0gXCJcIjtcblxuXG4gXHQvLyBMb2FkIGVudHJ5IG1vZHVsZSBhbmQgcmV0dXJuIGV4cG9ydHNcbiBcdHJldHVybiBfX3dlYnBhY2tfcmVxdWlyZV9fKF9fd2VicGFja19yZXF1aXJlX18ucyA9IDIpO1xuIiwiaW1wb3J0IENvbG9yVXRpbHMgZnJvbSAnLi9jb2xvci11dGlscyc7XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIEltYWdlUHJvY2Vzc2luZyB7XG4gIHN0YXRpYyBnZXRDb2xvckZyb21BcnJheShkYXRhLCBzdGFydEluZGV4KSB7XG4gICAgcmV0dXJuIENvbG9yVXRpbHMucmdiYVRvSGV4KHtcbiAgICAgIHI6IGRhdGFbc3RhcnRJbmRleF0sXG4gICAgICBnOiBkYXRhW3N0YXJ0SW5kZXggKyAxXSxcbiAgICAgIGI6IGRhdGFbc3RhcnRJbmRleCArIDJdLFxuICAgICAgYTogZGF0YVtzdGFydEluZGV4ICsgM10sXG4gICAgfSk7XG4gIH1cblxuICBzdGF0aWMgY291bnRDb2xvcnMoaW1hZ2VEYXRhLCBzaW1pbGFyaXR5VGhyZXNob2xkID0gMC45LCBvblByb2dyZXNzID0gKCkgPT4ge30pIHtcbiAgICBjb25zdCByZXN1bHQgPSBbXTtcblxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgaW1hZ2VEYXRhLmxlbmd0aDsgaSArPSA0KSB7XG4gICAgICBjb25zdCBoZXhDb2xvciA9IHRoaXMuZ2V0Q29sb3JGcm9tQXJyYXkoaW1hZ2VEYXRhLCBpKTtcblxuICAgICAgY29uc3QgZXhpc3RpbmdDb2xvciA9IHJlc3VsdC5maW5kKGRhdGEgPT4gQ29sb3JVdGlsc1xuICAgICAgICAuaGV4U2ltaWxhcml0eShkYXRhLmNvbG9yLCBoZXhDb2xvcikgPj0gc2ltaWxhcml0eVRocmVzaG9sZCk7XG5cbiAgICAgIGlmICghZXhpc3RpbmdDb2xvcikge1xuICAgICAgICByZXN1bHQucHVzaCh7XG4gICAgICAgICAgY29sb3I6IGhleENvbG9yLFxuICAgICAgICAgIGNvdW50OiAxLFxuICAgICAgICB9KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGV4aXN0aW5nQ29sb3IuY291bnQgKz0gMTtcbiAgICAgIH1cbiAgICAgIG9uUHJvZ3Jlc3MoaSAvIDQpO1xuICAgIH1cblxuICAgIHJldHVybiByZXN1bHQ7XG4gIH1cbn1cbiIsImV4cG9ydCBkZWZhdWx0IGNsYXNzIENvbG9yVXRpbHMge1xuICBzdGF0aWMgcmdiYVRvQ1NTKHJnYmFDb2xvcikge1xuICAgIHJldHVybiBgcmdiYSgke3JnYmFDb2xvci5yfSwgJHtyZ2JhQ29sb3IuZ30sICR7cmdiYUNvbG9yLmJ9LCAke3JnYmFDb2xvci5hfSlgO1xuICB9XG5cbiAgc3RhdGljIHJnYmFUb0hleChyZ2JhQ29sb3IpIHtcbiAgICByZXR1cm4gYCMke3RoaXMuaW50ZWdlclRvSGV4KHJnYmFDb2xvci5yKX0ke3RoaXMuaW50ZWdlclRvSGV4KHJnYmFDb2xvci5nKX0ke3RoaXMuaW50ZWdlclRvSGV4KHJnYmFDb2xvci5iKX0ke3RoaXMuaW50ZWdlclRvSGV4KHJnYmFDb2xvci5hKX1gO1xuICB9XG5cbiAgc3RhdGljIGludGVnZXJUb0hleChjKSB7XG4gICAgY29uc3QgaGV4ID0gYy50b1N0cmluZygxNik7XG4gICAgcmV0dXJuIGhleC5sZW5ndGggPT09IDEgPyBgMCR7aGV4fWAgOiBoZXg7XG4gIH1cblxuICBzdGF0aWMgaGV4VG9SZ2JhKGhleCkge1xuICAgIGNvbnN0IHJlc3VsdCA9IC9eIz8oW2EtZlxcZF17Mn0pKFthLWZcXGRdezJ9KShbYS1mXFxkXXsyfSkoW2EtZlxcZF17Mn0pPyQvaS5leGVjKGhleCk7XG5cbiAgICByZXR1cm4gcmVzdWx0ID8ge1xuICAgICAgcjogcGFyc2VJbnQocmVzdWx0WzFdLCAxNiksXG4gICAgICBnOiBwYXJzZUludChyZXN1bHRbMl0sIDE2KSxcbiAgICAgIGI6IHBhcnNlSW50KHJlc3VsdFszXSwgMTYpLFxuICAgICAgYTogcGFyc2VJbnQocmVzdWx0WzRdLCAxNiksXG4gICAgfSA6IG51bGw7XG4gIH1cblxuXG4gIHN0YXRpYyBldWNsaWRlYW5EaXN0YW5jZVNxdWFyZShsaXN0MSwgbGlzdDIpIHtcbiAgICBsZXQgc3VtID0gMDtcblxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbGlzdDEubGVuZ3RoOyBpICs9IDEpIHtcbiAgICAgIGNvbnN0IG9mZnNldCA9IGxpc3QxW2ldIC0gbGlzdDJbaV07XG4gICAgICBzdW0gKz0gb2Zmc2V0ICogb2Zmc2V0O1xuICAgIH1cblxuICAgIHJldHVybiBzdW07XG4gIH1cbiAgc3RhdGljIGhleFNpbWlsYXJpdHkoaGV4MSwgaGV4Mikge1xuICAgIHJldHVybiB0aGlzLnJnYlNpbWlsYXJpdHkodGhpcy5oZXhUb1JnYmEoaGV4MSksIHRoaXMuaGV4VG9SZ2JhKGhleDIpKTtcbiAgfVxuXG4gIHN0YXRpYyByZ2JTaW1pbGFyaXR5KHJnYjEsIHJnYjIpIHtcbiAgICBpZiAoIXRoaXMuUkdCX01BWF9ESVNUQU5DRV9TUVVBUkUpIHtcbiAgICAgIHRoaXMuUkdCX01BWF9ESVNUQU5DRV9TUVVBUkUgPSB0aGlzLmV1Y2xpZGVhbkRpc3RhbmNlU3F1YXJlKFsyNTUsIDI1NSwgMjU1XSwgWzAsIDAsIDBdKTtcbiAgICB9XG4gICAgY29uc3QgZGlzdGFuY2UgPSB0aGlzLmV1Y2xpZGVhbkRpc3RhbmNlU3F1YXJlKFtcbiAgICAgIHJnYjEucixcbiAgICAgIHJnYjEuZyxcbiAgICAgIHJnYjEuYixcbiAgICBdLCBbXG4gICAgICByZ2IyLnIsXG4gICAgICByZ2IyLmcsXG4gICAgICByZ2IyLmIsXG4gICAgXSk7XG5cbiAgICByZXR1cm4gMSAtIE1hdGguc3FydChkaXN0YW5jZSAvIHRoaXMuUkdCX01BWF9ESVNUQU5DRV9TUVVBUkUpO1xuICB9XG59XG4iLCIvKiBlc2xpbnQtZGlzYWJsZSBuby1yZXN0cmljdGVkLWdsb2JhbHMgKi9cbmltcG9ydCBJbWFnZVByb2Nlc3NpbmcgZnJvbSAnLi9pbWFnZS1wcm9jZXNzaW5nJztcblxuc2VsZi5hZGRFdmVudExpc3RlbmVyKCdtZXNzYWdlJywgKHsgZGF0YSB9KSA9PiB7XG4gIGNvbnN0IHtcbiAgICBpbWFnZURhdGEsXG4gICAgc2ltaWxhcml0eVRocmVzaG9sZCxcbiAgfSA9IGRhdGE7XG5cbiAgY29uc3QgdG90YWxQaXhlbHMgPSBpbWFnZURhdGEubGVuZ3RoIC8gNDtcbiAgY29uc3Qgc3RlcCA9IHRvdGFsUGl4ZWxzIC8gMTAwO1xuXG4gIGNvbnNvbGUubG9nKHRvdGFsUGl4ZWxzLCBzdGVwKTtcblxuICBjb25zdCBwcm9jZXNzZWREYXRhID0gSW1hZ2VQcm9jZXNzaW5nLmNvdW50Q29sb3JzKGltYWdlRGF0YSwgc2ltaWxhcml0eVRocmVzaG9sZCwgKGluZGV4KSA9PiB7XG4gICAgaWYgKGluZGV4ICUgc3RlcCA9PT0gMCkge1xuICAgICAgc2VsZi5wb3N0TWVzc2FnZSh7IHR5cGU6ICdwcm9ncmVzcycsIHBlcmNlbnRhZ2U6IChpbmRleCAvIHN0ZXApICsgMSB9KTtcbiAgICB9XG4gIH0pO1xuXG4gIHNlbGYucG9zdE1lc3NhZ2UoeyBwcm9jZXNzZWREYXRhIH0pO1xufSk7XG4iXSwic291cmNlUm9vdCI6IiJ9