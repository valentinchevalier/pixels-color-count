!function(e){var t={};function n(r){if(t[r])return t[r].exports;var a=t[r]={i:r,l:!1,exports:{}};return e[r].call(a.exports,a,a.exports,n),a.l=!0,a.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:r})},n.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=2)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r,a=(r=n(1))&&r.__esModule?r:{default:r};function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var i=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,r;return t=e,r=[{key:"getHexColorFromPixelsArray",value:function(e,t){return a.default.rgbaToHex({r:e[t],g:e[t+1],b:e[t+2],a:e[t+3]})}},{key:"countColors",value:function(e){for(var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.9,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){},o=[],i=function(i){var u=t.getHexColorFromPixelsArray(e,i),c=o.find(function(e){return a.default.hexSimilarity(e.color,u)>=n});c?c.count+=1:o.push({color:u,count:1}),r(i/4)},u=0;u<e.length;u+=4)i(u);return o}}],(n=null)&&o(t.prototype,n),r&&o(t,r),e}();t.default=i},function(e,t,n){"use strict";function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,a;return t=e,a=[{key:"rgbaToCSS",value:function(e){var t=e.a/255;return"rgba(".concat(e.r,", ").concat(e.g,", ").concat(e.b,", ").concat(t.toFixed(2),")")}},{key:"rgbaToHex",value:function(e){return"#".concat(this.integerToHex(e.r)).concat(this.integerToHex(e.g)).concat(this.integerToHex(e.b)).concat(this.integerToHex(e.a))}},{key:"integerToHex",value:function(e){var t=e.toString(16);return 1===t.length?"0".concat(t):t}},{key:"hexToRgba",value:function(e){var t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})?$/i.exec(e);return t?{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16),a:parseInt(t[4],16)}:null}},{key:"euclideanDistanceSquare",value:function(e,t){for(var n=0,r=0;r<e.length;r+=1){var a=e[r]-t[r];n+=a*a}return n}},{key:"hexSimilarity",value:function(e,t){return this.rgbSimilarity(this.hexToRgba(e),this.hexToRgba(t))}},{key:"rgbSimilarity",value:function(e,t){this.RGB_MAX_DISTANCE_SQUARE||(this.RGB_MAX_DISTANCE_SQUARE=this.euclideanDistanceSquare([255,255,255,255],[0,0,0,0]));var n=this.euclideanDistanceSquare([e.r,e.g,e.b,e.a],[t.r,t.g,t.b,t.a]);return 1-Math.sqrt(n/this.RGB_MAX_DISTANCE_SQUARE)}}],(n=null)&&r(t.prototype,n),a&&r(t,a),e}();t.default=a},function(e,t,n){"use strict";n.r(t);var r=n(0),a=n.n(r);self.addEventListener("message",({data:e})=>{const{imageData:t,similarityThreshold:n}=e,r=t.length/4/100,o=a.a.countColors(t,n,e=>{e%r==0&&self.postMessage({type:"progress",percentage:e/r+1})});self.postMessage({processedData:o})})}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vd2VicGFjay9ib290c3RyYXAiLCJ3ZWJwYWNrOi8vLy4vc3JjL2pzL2ltYWdlLXByb2Nlc3NpbmcuanMiLCJ3ZWJwYWNrOi8vLy4vc3JjL2pzL2NvbG9yLXV0aWxzLmpzIiwid2VicGFjazovLy8uL3NyYy9qcy9hbmFseXNlLXBpY3R1cmUud29ya2VyLmpzIl0sIm5hbWVzIjpbImluc3RhbGxlZE1vZHVsZXMiLCJfX3dlYnBhY2tfcmVxdWlyZV9fIiwibW9kdWxlSWQiLCJleHBvcnRzIiwibW9kdWxlIiwiaSIsImwiLCJtb2R1bGVzIiwiY2FsbCIsIm0iLCJjIiwiZCIsIm5hbWUiLCJnZXR0ZXIiLCJvIiwiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJjb25maWd1cmFibGUiLCJlbnVtZXJhYmxlIiwiZ2V0IiwiciIsInZhbHVlIiwibiIsIl9fZXNNb2R1bGUiLCJvYmplY3QiLCJwcm9wZXJ0eSIsInByb3RvdHlwZSIsImhhc093blByb3BlcnR5IiwicCIsInMiLCJfY29sb3JVdGlscyIsIkltYWdlUHJvY2Vzc2luZyIsImRhdGEiLCJzdGFydEluZGV4IiwiQ29sb3JVdGlscyIsInJnYmFUb0hleCIsImciLCJiIiwiYSIsImltYWdlRGF0YSIsIl90aGlzIiwidGhpcyIsInNpbWlsYXJpdHlUaHJlc2hvbGQiLCJhcmd1bWVudHMiLCJsZW5ndGgiLCJ1bmRlZmluZWQiLCJvblByb2dyZXNzIiwicmVzdWx0IiwiX2xvb3AiLCJoZXhDb2xvciIsImdldEhleENvbG9yRnJvbVBpeGVsc0FycmF5IiwiZXhpc3RpbmdDb2xvciIsImZpbmQiLCJoZXhTaW1pbGFyaXR5IiwiY29sb3IiLCJjb3VudCIsInB1c2giLCJyZ2JhQ29sb3IiLCJhbHBoYSIsImNvbmNhdCIsInRvRml4ZWQiLCJpbnRlZ2VyVG9IZXgiLCJoZXgiLCJ0b1N0cmluZyIsImV4ZWMiLCJwYXJzZUludCIsImxpc3QxIiwibGlzdDIiLCJzdW0iLCJvZmZzZXQiLCJoZXgxIiwiaGV4MiIsInJnYlNpbWlsYXJpdHkiLCJoZXhUb1JnYmEiLCJyZ2IxIiwicmdiMiIsIlJHQl9NQVhfRElTVEFOQ0VfU1FVQVJFIiwiZXVjbGlkZWFuRGlzdGFuY2VTcXVhcmUiLCJkaXN0YW5jZSIsIk1hdGgiLCJzcXJ0IiwiX2ltYWdlX3Byb2Nlc3NpbmdfX1dFQlBBQ0tfSU1QT1JURURfTU9EVUxFXzBfXyIsIl9pbWFnZV9wcm9jZXNzaW5nX19XRUJQQUNLX0lNUE9SVEVEX01PRFVMRV8wX19fZGVmYXVsdCIsInNlbGYiLCJhZGRFdmVudExpc3RlbmVyIiwic3RlcCIsInByb2Nlc3NlZERhdGEiLCJjb3VudENvbG9ycyIsImluZGV4IiwicG9zdE1lc3NhZ2UiLCJ0eXBlIiwicGVyY2VudGFnZSJdLCJtYXBwaW5ncyI6ImFBQ0EsSUFBQUEsS0FHQSxTQUFBQyxFQUFBQyxHQUdBLEdBQUFGLEVBQUFFLEdBQ0EsT0FBQUYsRUFBQUUsR0FBQUMsUUFHQSxJQUFBQyxFQUFBSixFQUFBRSxJQUNBRyxFQUFBSCxFQUNBSSxHQUFBLEVBQ0FILFlBVUEsT0FOQUksRUFBQUwsR0FBQU0sS0FBQUosRUFBQUQsUUFBQUMsSUFBQUQsUUFBQUYsR0FHQUcsRUFBQUUsR0FBQSxFQUdBRixFQUFBRCxRQUtBRixFQUFBUSxFQUFBRixFQUdBTixFQUFBUyxFQUFBVixFQUdBQyxFQUFBVSxFQUFBLFNBQUFSLEVBQUFTLEVBQUFDLEdBQ0FaLEVBQUFhLEVBQUFYLEVBQUFTLElBQ0FHLE9BQUFDLGVBQUFiLEVBQUFTLEdBQ0FLLGNBQUEsRUFDQUMsWUFBQSxFQUNBQyxJQUFBTixLQU1BWixFQUFBbUIsRUFBQSxTQUFBakIsR0FDQVksT0FBQUMsZUFBQWIsRUFBQSxjQUFpRGtCLE9BQUEsS0FJakRwQixFQUFBcUIsRUFBQSxTQUFBbEIsR0FDQSxJQUFBUyxFQUFBVCxLQUFBbUIsV0FDQSxXQUEyQixPQUFBbkIsRUFBQSxTQUMzQixXQUFpQyxPQUFBQSxHQUVqQyxPQURBSCxFQUFBVSxFQUFBRSxFQUFBLElBQUFBLEdBQ0FBLEdBSUFa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LEtBQUttQyx1SEMxRHpDLElBQUFLLEVBQUFoRixFQUFBLEdBQUFpRixFQUFBakYsRUFBQXFCLEVBQUEyRCxHQUdBRSxLQUFBQyxpQkFBQSxZQUFtQ3BELFdBQ25DLE1BQUFPLFVBQ0FBLEVBQUFHLG9CQUNBQSxHQUNHVixFQUdIcUQsRUFEQTlDLEVBQUFLLE9BQUEsRUFDQSxJQUVBMEMsRUFBQUosRUFBQTVDLEVBQUFpRCxZQUFBaEQsRUFBQUcsRUFBQThDLElBQ0FBLEVBQUFILEdBQUEsR0FDQUYsS0FBQU0sYUFBd0JDLEtBQUEsV0FBQUMsV0FBQUgsRUFBQUgsRUFBQSxNQUl4QkYsS0FBQU0sYUFBb0JIIiwiZmlsZSI6ImQzYWMxYjYzMDBjYjVlYzY2OWI2Lndvcmtlci5qcyIsInNvdXJjZXNDb250ZW50IjpbIiBcdC8vIFRoZSBtb2R1bGUgY2FjaGVcbiBcdHZhciBpbnN0YWxsZWRNb2R1bGVzID0ge307XG5cbiBcdC8vIFRoZSByZXF1aXJlIGZ1bmN0aW9uXG4gXHRmdW5jdGlvbiBfX3dlYnBhY2tfcmVxdWlyZV9fKG1vZHVsZUlkKSB7XG5cbiBcdFx0Ly8gQ2hlY2sgaWYgbW9kdWxlIGlzIGluIGNhY2hlXG4gXHRcdGlmKGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdKSB7XG4gXHRcdFx0cmV0dXJuIGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdLmV4cG9ydHM7XG4gXHRcdH1cbiBcdFx0Ly8gQ3JlYXRlIGEgbmV3IG1vZHVsZSAoYW5kIHB1dCBpdCBpbnRvIHRoZSBjYWNoZSlcbiBcdFx0dmFyIG1vZHVsZSA9IGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdID0ge1xuIFx0XHRcdGk6IG1vZHVsZUlkLFxuIFx0XHRcdGw6IGZhbHNlLFxuIFx0XHRcdGV4cG9ydHM6IHt9XG4gXHRcdH07XG5cbiBcdFx0Ly8gRXhlY3V0ZSB0aGUgbW9kdWxlIGZ1bmN0aW9uXG4gXHRcdG1vZHVsZXNbbW9kdWxlSWRdLmNhbGwobW9kdWxlLmV4cG9ydHMsIG1vZHVsZSwgbW9kdWxlLmV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pO1xuXG4gXHRcdC8vIEZsYWcgdGhlIG1vZHVsZSBhcyBsb2FkZWRcbiBcdFx0bW9kdWxlLmwgPSB0cnVlO1xuXG4gXHRcdC8vIFJldHVybiB0aGUgZXhwb3J0cyBvZiB0aGUgbW9kdWxlXG4gXHRcdHJldHVybiBtb2R1bGUuZXhwb3J0cztcbiBcdH1cblxuXG4gXHQvLyBleHBvc2UgdGhlIG1vZHVsZXMgb2JqZWN0IChfX3dlYnBhY2tfbW9kdWxlc19fKVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5tID0gbW9kdWxlcztcblxuIFx0Ly8gZXhwb3NlIHRoZSBtb2R1bGUgY2FjaGVcbiBcdF9fd2VicGFja19yZXF1aXJlX18uYyA9IGluc3RhbGxlZE1vZHVsZXM7XG5cbiBcdC8vIGRlZmluZSBnZXR0ZXIgZnVuY3Rpb24gZm9yIGhhcm1vbnkgZXhwb3J0c1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5kID0gZnVuY3Rpb24oZXhwb3J0cywgbmFtZSwgZ2V0dGVyKSB7XG4gXHRcdGlmKCFfX3dlYnBhY2tfcmVxdWlyZV9fLm8oZXhwb3J0cywgbmFtZSkpIHtcbiBcdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgbmFtZSwge1xuIFx0XHRcdFx0Y29uZmlndXJhYmxlOiBmYWxzZSxcbiBcdFx0XHRcdGVudW1lcmFibGU6IHRydWUsXG4gXHRcdFx0XHRnZXQ6IGdldHRlclxuIFx0XHRcdH0pO1xuIFx0XHR9XG4gXHR9O1xuXG4gXHQvLyBkZWZpbmUgX19lc01vZHVsZSBvbiBleHBvcnRzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLnIgPSBmdW5jdGlvbihleHBvcnRzKSB7XG4gXHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAnX19lc01vZHVsZScsIHsgdmFsdWU6IHRydWUgfSk7XG4gXHR9O1xuXG4gXHQvLyBnZXREZWZhdWx0RXhwb3J0IGZ1bmN0aW9uIGZvciBjb21wYXRpYmlsaXR5IHdpdGggbm9uLWhhcm1vbnkgbW9kdWxlc1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5uID0gZnVuY3Rpb24obW9kdWxlKSB7XG4gXHRcdHZhciBnZXR0ZXIgPSBtb2R1bGUgJiYgbW9kdWxlLl9fZXNNb2R1bGUgP1xuIFx0XHRcdGZ1bmN0aW9uIGdldERlZmF1bHQoKSB7IHJldHVybiBtb2R1bGVbJ2RlZmF1bHQnXTsgfSA6XG4gXHRcdFx0ZnVuY3Rpb24gZ2V0TW9kdWxlRXhwb3J0cygpIHsgcmV0dXJuIG1vZHVsZTsgfTtcbiBcdFx0X193ZWJwYWNrX3JlcXVpcmVfXy5kKGdldHRlciwgJ2EnLCBnZXR0ZXIpO1xuIFx0XHRyZXR1cm4gZ2V0dGVyO1xuIFx0fTtcblxuIFx0Ly8gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm8gPSBmdW5jdGlvbihvYmplY3QsIHByb3BlcnR5KSB7IHJldHVybiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob2JqZWN0LCBwcm9wZXJ0eSk7IH07XG5cbiBcdC8vIF9fd2VicGFja19wdWJsaWNfcGF0aF9fXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLnAgPSBcIlwiO1xuXG5cbiBcdC8vIExvYWQgZW50cnkgbW9kdWxlIGFuZCByZXR1cm4gZXhwb3J0c1xuIFx0cmV0dXJuIF9fd2VicGFja19yZXF1aXJlX18oX193ZWJwYWNrX3JlcXVpcmVfXy5zID0gMik7XG4iLCJpbXBvcnQgQ29sb3JVdGlscyBmcm9tICcuL2NvbG9yLXV0aWxzJztcblxuY29uc3QgQ09NUE9ORU5UU19CWV9QSVhFTCA9IDQ7XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIEltYWdlUHJvY2Vzc2luZyB7XG4gIHN0YXRpYyBnZXRIZXhDb2xvckZyb21QaXhlbHNBcnJheShkYXRhLCBzdGFydEluZGV4KSB7XG4gICAgcmV0dXJuIENvbG9yVXRpbHMucmdiYVRvSGV4KHtcbiAgICAgIHI6IGRhdGFbc3RhcnRJbmRleF0sXG4gICAgICBnOiBkYXRhW3N0YXJ0SW5kZXggKyAxXSxcbiAgICAgIGI6IGRhdGFbc3RhcnRJbmRleCArIDJdLFxuICAgICAgYTogZGF0YVtzdGFydEluZGV4ICsgM10sXG4gICAgfSk7XG4gIH1cblxuICBzdGF0aWMgY291bnRDb2xvcnMoaW1hZ2VEYXRhLCBzaW1pbGFyaXR5VGhyZXNob2xkID0gMC45LCBvblByb2dyZXNzID0gKCkgPT4ge30pIHtcbiAgICBjb25zdCByZXN1bHQgPSBbXTtcblxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgaW1hZ2VEYXRhLmxlbmd0aDsgaSArPSBDT01QT05FTlRTX0JZX1BJWEVMKSB7XG4gICAgICBjb25zdCBoZXhDb2xvciA9IHRoaXMuZ2V0SGV4Q29sb3JGcm9tUGl4ZWxzQXJyYXkoaW1hZ2VEYXRhLCBpKTtcblxuICAgICAgY29uc3QgZXhpc3RpbmdDb2xvciA9IHJlc3VsdC5maW5kKGRhdGEgPT4gQ29sb3JVdGlsc1xuICAgICAgICAuaGV4U2ltaWxhcml0eShkYXRhLmNvbG9yLCBoZXhDb2xvcikgPj0gc2ltaWxhcml0eVRocmVzaG9sZCk7XG5cbiAgICAgIGlmICghZXhpc3RpbmdDb2xvcikge1xuICAgICAgICByZXN1bHQucHVzaCh7XG4gICAgICAgICAgY29sb3I6IGhleENvbG9yLFxuICAgICAgICAgIGNvdW50OiAxLFxuICAgICAgICB9KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGV4aXN0aW5nQ29sb3IuY291bnQgKz0gMTtcbiAgICAgIH1cblxuICAgICAgb25Qcm9ncmVzcyhpIC8gQ09NUE9ORU5UU19CWV9QSVhFTCk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfVxufVxuIiwiZXhwb3J0IGRlZmF1bHQgY2xhc3MgQ29sb3JVdGlscyB7XG4gIHN0YXRpYyByZ2JhVG9DU1MocmdiYUNvbG9yKSB7XG4gICAgY29uc3QgYWxwaGEgPSByZ2JhQ29sb3IuYSAvIDI1NTtcbiAgICByZXR1cm4gYHJnYmEoJHtyZ2JhQ29sb3Iucn0sICR7cmdiYUNvbG9yLmd9LCAke3JnYmFDb2xvci5ifSwgJHthbHBoYS50b0ZpeGVkKDIpfSlgO1xuICB9XG5cbiAgc3RhdGljIHJnYmFUb0hleChyZ2JhQ29sb3IpIHtcbiAgICByZXR1cm4gYCMke3RoaXMuaW50ZWdlclRvSGV4KHJnYmFDb2xvci5yKX0ke3RoaXMuaW50ZWdlclRvSGV4KHJnYmFDb2xvci5nKX0ke3RoaXMuaW50ZWdlclRvSGV4KHJnYmFDb2xvci5iKX0ke3RoaXMuaW50ZWdlclRvSGV4KHJnYmFDb2xvci5hKX1gO1xuICB9XG5cbiAgc3RhdGljIGludGVnZXJUb0hleChjKSB7XG4gICAgY29uc3QgaGV4ID0gYy50b1N0cmluZygxNik7XG4gICAgcmV0dXJuIGhleC5sZW5ndGggPT09IDEgPyBgMCR7aGV4fWAgOiBoZXg7XG4gIH1cblxuICBzdGF0aWMgaGV4VG9SZ2JhKGhleCkge1xuICAgIGNvbnN0IHJlc3VsdCA9IC9eIz8oW2EtZlxcZF17Mn0pKFthLWZcXGRdezJ9KShbYS1mXFxkXXsyfSkoW2EtZlxcZF17Mn0pPyQvaS5leGVjKGhleCk7XG5cbiAgICByZXR1cm4gcmVzdWx0ID8ge1xuICAgICAgcjogcGFyc2VJbnQocmVzdWx0WzFdLCAxNiksXG4gICAgICBnOiBwYXJzZUludChyZXN1bHRbMl0sIDE2KSxcbiAgICAgIGI6IHBhcnNlSW50KHJlc3VsdFszXSwgMTYpLFxuICAgICAgYTogcGFyc2VJbnQocmVzdWx0WzRdLCAxNiksXG4gICAgfSA6IG51bGw7XG4gIH1cblxuICBzdGF0aWMgZXVjbGlkZWFuRGlzdGFuY2VTcXVhcmUobGlzdDEsIGxpc3QyKSB7XG4gICAgbGV0IHN1bSA9IDA7XG5cbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGxpc3QxLmxlbmd0aDsgaSArPSAxKSB7XG4gICAgICBjb25zdCBvZmZzZXQgPSBsaXN0MVtpXSAtIGxpc3QyW2ldO1xuICAgICAgc3VtICs9IG9mZnNldCAqIG9mZnNldDtcbiAgICB9XG5cbiAgICByZXR1cm4gc3VtO1xuICB9XG5cbiAgc3RhdGljIGhleFNpbWlsYXJpdHkoaGV4MSwgaGV4Mikge1xuICAgIHJldHVybiB0aGlzLnJnYlNpbWlsYXJpdHkodGhpcy5oZXhUb1JnYmEoaGV4MSksIHRoaXMuaGV4VG9SZ2JhKGhleDIpKTtcbiAgfVxuXG4gIHN0YXRpYyByZ2JTaW1pbGFyaXR5KHJnYjEsIHJnYjIpIHtcbiAgICBpZiAoIXRoaXMuUkdCX01BWF9ESVNUQU5DRV9TUVVBUkUpIHtcbiAgICAgIHRoaXMuUkdCX01BWF9ESVNUQU5DRV9TUVVBUkUgPVxuICAgICAgICB0aGlzLmV1Y2xpZGVhbkRpc3RhbmNlU3F1YXJlKFsyNTUsIDI1NSwgMjU1LCAyNTVdLCBbMCwgMCwgMCwgMF0pO1xuICAgIH1cbiAgICBjb25zdCBkaXN0YW5jZSA9IHRoaXMuZXVjbGlkZWFuRGlzdGFuY2VTcXVhcmUoW1xuICAgICAgcmdiMS5yLFxuICAgICAgcmdiMS5nLFxuICAgICAgcmdiMS5iLFxuICAgICAgcmdiMS5hLFxuICAgIF0sIFtcbiAgICAgIHJnYjIucixcbiAgICAgIHJnYjIuZyxcbiAgICAgIHJnYjIuYixcbiAgICAgIHJnYjIuYSxcbiAgICBdKTtcblxuICAgIHJldHVybiAxIC0gTWF0aC5zcXJ0KGRpc3RhbmNlIC8gdGhpcy5SR0JfTUFYX0RJU1RBTkNFX1NRVUFSRSk7XG4gIH1cbn1cbiIsIi8qIGVzbGludC1kaXNhYmxlIG5vLXJlc3RyaWN0ZWQtZ2xvYmFscyAqL1xuaW1wb3J0IEltYWdlUHJvY2Vzc2luZyBmcm9tICcuL2ltYWdlLXByb2Nlc3NpbmcnO1xuXG5zZWxmLmFkZEV2ZW50TGlzdGVuZXIoJ21lc3NhZ2UnLCAoeyBkYXRhIH0pID0+IHtcbiAgY29uc3Qge1xuICAgIGltYWdlRGF0YSxcbiAgICBzaW1pbGFyaXR5VGhyZXNob2xkLFxuICB9ID0gZGF0YTtcblxuICBjb25zdCB0b3RhbFBpeGVscyA9IGltYWdlRGF0YS5sZW5ndGggLyA0O1xuICBjb25zdCBzdGVwID0gdG90YWxQaXhlbHMgLyAxMDA7XG5cbiAgY29uc3QgcHJvY2Vzc2VkRGF0YSA9IEltYWdlUHJvY2Vzc2luZy5jb3VudENvbG9ycyhpbWFnZURhdGEsIHNpbWlsYXJpdHlUaHJlc2hvbGQsIChpbmRleCkgPT4ge1xuICAgIGlmIChpbmRleCAlIHN0ZXAgPT09IDApIHtcbiAgICAgIHNlbGYucG9zdE1lc3NhZ2UoeyB0eXBlOiAncHJvZ3Jlc3MnLCBwZXJjZW50YWdlOiAoaW5kZXggLyBzdGVwKSArIDEgfSk7XG4gICAgfVxuICB9KTtcblxuICBzZWxmLnBvc3RNZXNzYWdlKHsgcHJvY2Vzc2VkRGF0YSB9KTtcbn0pO1xuIl0sInNvdXJjZVJvb3QiOiIifQ==